<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>repo.c</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include "repo.h"

#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;assert.h&gt;

<span style = "background-color:#dfd">Repo* createEmpty(destroy_fct f) {
	Repo* lista = malloc(sizeof(Repo));</span>

<span style = "background-color:#dfd">	if (lista == NULL) {</span>
<span style = "background-color:#fdd">		return NULL;</span>
	}

<span style = "background-color:#dfd">	lista-&gt;capacitate = 2;
	lista-&gt;lungime = 0;
	lista-&gt;elemente = malloc(lista-&gt;capacitate * sizeof(ElemType));</span>

<span style = "background-color:#dfd">	if (lista-&gt;elemente == NULL) {</span>
<span style = "background-color:#fdd">		free(lista);
		return NULL;</span>
	}

<span style = "background-color:#dfd">	lista-&gt;dest = f;</span>

<span style = "background-color:#dfd">	return lista;
}</span>

<span style = "background-color:#dfd">void destroy(Repo* lista) {
	for (int i = 0; i &lt; lista-&gt;lungime; ++i) {
		lista-&gt;dest(lista-&gt;elemente[i]);
	}
	free(lista-&gt;elemente);
	free(lista);
}</span>

<span style = "background-color:#dfd">void extind(Repo* lista) {
	if (lista-&gt;lungime == lista-&gt;capacitate) {
		lista-&gt;capacitate *= 2;
		ElemType* temporar = malloc(lista-&gt;capacitate * sizeof(ElemType));</span>

<span style = "background-color:#dfd">		for (int i = 0; i &lt; lista-&gt;lungime; ++i) {
			temporar[i] = lista-&gt;elemente[i];
		}
		free(lista-&gt;elemente);
		lista-&gt;elemente = temporar;</span>
	}
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">int add(Repo* lista, ElemType* element, egale_fct eq, egale_coduri ec, cantitate_fct cant) {</span>

<span style = "background-color:#dfd">	int succes = 0;
	for (int i = 0; i &lt; lista-&gt;lungime; ++i) {
		if (eq(lista-&gt;elemente[i], element)) {
			cant(lista-&gt;elemente[i], element);
			succes = 1;
		}
		else if (ec(lista-&gt;elemente[i], element)) {
			succes = -1;</span>
		}
<span style = "background-color:#dfd">	}
	if (succes == 1) {
		lista-&gt;dest(element);
		return 0;</span>
<span style = "background-color:#fdd">	}</span>
<span style = "background-color:#dfd">	else if (succes == -1) {
		lista-&gt;dest(element);
		return 1;</span>
	}

<span style = "background-color:#dfd">	extind(lista);
	lista-&gt;elemente[lista-&gt;lungime++] = element;</span>

<span style = "background-color:#dfd">	return 0;</span>
	
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">int modify(Repo* lista, ElemType* element, egal_modify eg, cantitate_fct cant) {</span>

<span style = "background-color:#dfd">	for (int i = 0; i &lt; lista-&gt;lungime; ++i) {
		if (eg(lista-&gt;elemente[i], element)) {</span>

<span style = "background-color:#dfd">			cant(element, lista-&gt;elemente[i]);
			lista-&gt;dest(lista-&gt;elemente[i]);
			lista-&gt;elemente[i] = element;
			return 0;</span>
		}
<span style = "background-color:#dfd">	}
	lista-&gt;dest(element);
	return 1;
}</span>

<span style = "background-color:#dfd">int deleteStoc(Repo* lista, int cod, return_cod cd, sterge_cant sterge) {</span>

<span style = "background-color:#dfd">	for (int i = 0; i &lt; lista-&gt;lungime; ++i) {</span>

<span style = "background-color:#dfd">		if (cd(lista-&gt;elemente[i]) == cod) {
			sterge(lista-&gt;elemente[i]);
			return 0;</span>
		}
<span style = "background-color:#dfd">	}
	return 1;
}</span>


<span style = "background-color:#dfd">Repo* copyList(Repo* lista, copy_fct cpy) {</span>

<span style = "background-color:#dfd">	Repo* lista_noua = createEmpty(lista-&gt;dest);</span>

<span style = "background-color:#dfd">	for (int i = 0; i &lt; lista-&gt;lungime; ++i) {
		add(lista_noua, cpy(lista-&gt;elemente[i]), (egale_fct) egalMedicamente, (egale_coduri) egalCod,</span>
			(cantitate_fct) adaugaCantitate);
<span style = "background-color:#dfd">	}
	return lista_noua;
}</span>
/// &lt;summary&gt;
/// TESTE
/// &lt;/summary&gt;

<span style = "background-color:#dfd">void test_createEmpty() {
	Repo* repo = createEmpty(&amp;destroyMedicament);
	assert(repo != NULL);
	assert(repo-&gt;capacitate == 2);
	assert(repo-&gt;lungime == 0);
	destroy(repo);
}</span>

<span style = "background-color:#dfd">void test_destroy() {
	Repo* repo = createEmpty(&amp;destroyMedicament);
	Medicament* m1 = createMedicament(1, "Paracetamol", 500, 20);
	Medicament* m2 = createMedicament(2, "Ibuprofen", 400, 30);
	add(repo, m1, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate);
	add(repo, m2, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate);</span>

<span style = "background-color:#dfd">	destroy(repo);</span>


	// Ensure repo is NULL after destruction
<span style = "background-color:#dfd">	assert(repo-&gt;lungime != 2);
	assert(repo-&gt;capacitate != 2);
}</span>

<span style = "background-color:#dfd">void test_extind() {
	Repo* repo = createEmpty(&amp;destroyMedicament);
	assert(repo-&gt;capacitate == 2);</span>

	// Add elements until extension is needed
<span style = "background-color:#dfd">	for (int i = 0; i &lt; 3; ++i) {
		Medicament* m = createMedicament(i + 1, "Med", 100, 10);
		add(repo, m, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate);\
	}</span>

<span style = "background-color:#dfd">	assert(repo-&gt;capacitate == 4);</span>

<span style = "background-color:#dfd">	destroy(repo);</span>

<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">void test_add() {
	Repo* repo = createEmpty(&amp;destroyMedicament);
	Medicament* m1 = createMedicament(1, "Paracetamol", 500, 20);
	Medicament* m2 = createMedicament(2, "Ibuprofen", 400, 30);
	assert(add(repo, m1, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate) == 0);
	assert(add(repo, m2, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate) == 0);</span>

	// Adding a medicine with same cod as m1 should increase m1's quantity
<span style = "background-color:#dfd">	Medicament* m3 = createMedicament(1, "Paracetamol", 500, 10);
	assert(add(repo, m3, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate) == 0);
	Medicament* m4 = createMedicament(1, "Paracetamol", 400, 10);
	assert(add(repo, m4, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate) == 1);
	assert(returnCod(repo-&gt;elemente[0]) == 1);
	assert(repo-&gt;lungime == 2);</span>

<span style = "background-color:#dfd">	destroy(repo);
}</span>

<span style = "background-color:#dfd">void test_modify() {
	Repo* repo = createEmpty(&amp;destroyMedicament);
	Medicament* m1 = createMedicament(1, "Paracetamol", 500, 20);
	add(repo, m1, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate);</span>

	// Modify the quantity of m1
<span style = "background-color:#dfd">	Medicament* m2 = createMedicament(1, "Paracetamol", 500, 10);
	assert(modify(repo, m2, (egal_modify)egalModify, (cantitate_fct)adaugaCantitate) == 0);</span>

<span style = "background-color:#dfd">	Medicament* m3 = createMedicament(2, "Paracetamol", 500, 10);
	assert(modify(repo, m3, (egal_modify)egalModify, (cantitate_fct)adaugaCantitate) == 1);</span>

<span style = "background-color:#dfd">	destroy(repo);
}</span>

<span style = "background-color:#dfd">void test_deleteStoc() {
	Repo* repo = createEmpty(&amp;destroyMedicament);
	Medicament* m1 = createMedicament(1, "Paracetamol", 500, 20);
	Medicament* m2 = createMedicament(2, "Ibuprofen", 400, 30);
	add(repo, m1, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate);
	add(repo, m2, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate);</span>

<span style = "background-color:#dfd">	assert(deleteStoc(repo, 1, (return_cod)returnCod, (sterge_cant)stergeCantitate) == 0);
	assert(repo-&gt;lungime == 2);</span>

<span style = "background-color:#dfd">	assert(deleteStoc(repo, 3, (return_cod)returnCod, (sterge_cant)stergeCantitate) == 1);</span>

<span style = "background-color:#dfd">	destroy(repo);
}</span>

<span style = "background-color:#dfd">void test_copyList() {
	Repo* repo = createEmpty(&amp;destroyMedicament);
	Medicament* m1 = createMedicament(1, "Paracetamol", 500, 20);
	Medicament* m2 = createMedicament(2, "Ibuprofen", 400, 30);
	add(repo, m1, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate);
	add(repo, m2, (egale_fct)egalMedicamente, (egale_coduri)egalCod, (cantitate_fct)adaugaCantitate);</span>

<span style = "background-color:#dfd">	Repo* copiedRepo = copyList(repo, (copy_fct)copyMedicament);
	assert(copiedRepo-&gt;lungime == 2);</span>

<span style = "background-color:#dfd">	destroy(repo);
	destroy(copiedRepo); </span>

<span style = "background-color:#dfd">}</span>
</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>